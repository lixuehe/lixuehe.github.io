I"¬0<h1 id="nodejsåŸºæœ¬æ¨¡å—">NodeJsåŸºæœ¬æ¨¡å—</h1>

<h4 id="stream">stream</h4>

<p><code class="highlighter-rouge">stream</code>æ˜¯Node.jsæä¾›çš„åˆä¸€ä¸ªä»…åœ¨æœåŠ¡åŒºç«¯å¯ç”¨çš„æ¨¡å—ï¼Œç›®çš„æ˜¯æ”¯æŒâ€œæµâ€è¿™ç§æ•°æ®ç»“æ„ã€‚</p>

<ol>
  <li>æµçš„ç‰¹ç‚¹æ˜¯æ•°æ®æ˜¯æœ‰åºçš„ï¼Œè€Œä¸”å¿…é¡»ä¾æ¬¡è¯»å–ï¼Œæˆ–è€…ä¾æ¬¡å†™å…¥ï¼Œä¸èƒ½åƒArrayé‚£æ ·éšæœºå®šä½ã€‚</li>
  <li>æ ‡å‡†è¾“å…¥æµï¼ˆstdinï¼‰:æ•²é”®ç›˜çš„æ—¶å€™ï¼Œå°±å¯ä»¥æŠŠæ¯ä¸ªå­—ç¬¦ä¾æ¬¡è¿èµ·æ¥ï¼Œçœ‹æˆå­—ç¬¦æµã€‚è¿™ä¸ªæµæ˜¯ä»é”®ç›˜è¾“å…¥åˆ°åº”ç”¨ç¨‹åº;</li>
  <li>æ ‡å‡†è¾“å‡ºæµï¼ˆstdoutï¼‰:å¦‚æœåº”ç”¨ç¨‹åºæŠŠå­—ç¬¦ä¸€ä¸ªä¸€ä¸ªè¾“å‡ºåˆ°æ˜¾ç¤ºå™¨ä¸Šï¼Œè¿™ä¹Ÿå¯ä»¥çœ‹æˆæ˜¯ä¸€ä¸ªæµ;</li>
  <li><code class="highlighter-rouge">data</code>äº‹ä»¶è¡¨ç¤ºæµçš„æ•°æ®å·²ç»å¯ä»¥è¯»å–äº†ï¼Œ<code class="highlighter-rouge">end</code>äº‹ä»¶è¡¨ç¤ºè¿™ä¸ªæµå·²ç»åˆ°æœ«å°¾äº†ï¼Œæ²¡æœ‰æ•°æ®å¯ä»¥è¯»å–äº†ï¼Œ<code class="highlighter-rouge">error</code>äº‹ä»¶è¡¨ç¤ºå‡ºé”™äº†ã€‚</li>
</ol>

<p>æ¡ˆä¾‹:</p>

<p><strong>ï¼‘ï¼è¯»å–æ–‡ä»¶å†…æ•°æ®ï¼š</strong></p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>'use strict';
var fs=require('fs');
//æ‰“å¼€ä¸€ä¸ªæµ
var rs=fs.createReadStream('sample.txt','utf-8');
rs.on('data',function(chunk){
    console.log('DATA');
    console.log(chunk);
});
rs.on('end',function(){
    console.log('END');
});
rs.on('error',function(err){
    console.log('ERROR:'+err);
});

è¿è¡Œç»“æœï¼š
DATA
abcd
END
</code></pre></div></div>

<p><strong>2.å†™å…¥æ•°æ®</strong></p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>'use strict';
var fs = require('fs');
//åœ¨output1.txtæ–‡ä»¶ä¸­å†™å…¥ä¸¤è¡Œæ•°æ®ï¼š
var ws1 = fs.createWriteStream('output1.txt', 'utf-8');
ws1.write('ä½¿ç”¨Streamå†™å…¥æ–‡æœ¬æ•°æ®...\n');
ws1.write('END.');
ws1.end();
//åœ¨output2.txtæ–‡ä»¶ä¸­å†™å…¥ä¸¤è¡Œæ•°æ®ï¼š
var ws2 = fs.createWriteStream('output2.txt');
ws2.write(new Buffer('ä½¿ç”¨Streamå†™å…¥äºŒè¿›åˆ¶æ•°æ®...\n', 'utf-8'));
ws2.write(new Buffer('END.', 'utf-8'));
ws2.end();
</code></pre></div></div>

<p><strong><em>æ‰€æœ‰å¯ä»¥è¯»å–æ•°æ®çš„æµéƒ½ç»§æ‰¿è‡ª<code class="highlighter-rouge">stream.Readable</code>ï¼Œæ‰€æœ‰å¯ä»¥å†™å…¥çš„æµéƒ½ç»§æ‰¿è‡ª<code class="highlighter-rouge">stream.Writable</code>ã€‚</em></strong></p>

<h3 id="pipeè‡ªåŠ¨å®ç°è¾“å‡ºè¾“å…¥æµçš„è¿æ¥">pipe(è‡ªåŠ¨å®ç°è¾“å‡ºè¾“å…¥æµçš„è¿æ¥)</h3>

<ul>
  <li>
    <p>å°†ä¸€ä¸ª<code class="highlighter-rouge">Readable</code>æµå’Œä¸€ä¸ª<code class="highlighter-rouge">Writable</code>æµä¸²èµ·æ¥åï¼Œæ‰€æœ‰çš„æ•°æ®è‡ªåŠ¨ä»<code class="highlighter-rouge">Readable</code>æµè¿›å…¥<code class="highlighter-rouge">Writable</code>æµï¼Œè¿™ç§æ“ä½œå«<code class="highlighter-rouge">pipe</code>ã€‚</p>
  </li>
  <li>
    <p>è®©æˆ‘ä»¬ç”¨<code class="highlighter-rouge">pipe()</code>æŠŠä¸€ä¸ªæ–‡ä»¶æµå’Œå¦ä¸€ä¸ªæ–‡ä»¶æµä¸²èµ·æ¥ï¼Œè¿™æ ·æºæ–‡ä»¶çš„æ‰€æœ‰æ•°æ®å°±è‡ªåŠ¨å†™å…¥åˆ°ç›®æ ‡æ–‡ä»¶é‡Œäº†ï¼Œæ‰€ä»¥ï¼Œè¿™å®é™…ä¸Šæ˜¯ä¸€ä¸ªå¤åˆ¶æ–‡ä»¶çš„ç¨‹åºï¼š</p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>'use strict';
var fs = require('fs');
var rs = fs.createReadStream('sample.txt');
var ws = fs.createWriteStream('copied.txt');
//å®ç°äº†å°†sample.txtä¸­çš„æ–‡ä»¶è¯»å–å‡ºæ¥å¹¶ç›´æ¥å†™å…¥åˆ°copied.txtæ–‡ä»¶ä¸­
rs.pipe(ws);
</code></pre></div>    </div>
  </li>
  <li>
    <p>é»˜è®¤æƒ…å†µä¸‹ï¼Œå½“<code class="highlighter-rouge">Readable</code>æµçš„æ•°æ®è¯»å–å®Œæ¯•ï¼Œ<code class="highlighter-rouge">end</code>äº‹ä»¶è§¦å‘åï¼Œå°†è‡ªåŠ¨å…³é—­<code class="highlighter-rouge">Writable</code>æµã€‚å¦‚æœæˆ‘ä»¬ä¸å¸Œæœ›è‡ªåŠ¨å…³é—­<code class="highlighter-rouge">Writable</code>æµï¼Œéœ€è¦ä¼ å…¥å‚æ•°ï¼š</p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>readable.pipe(writable, { end: false });
</code></pre></div>    </div>
  </li>
</ul>

<hr />

<h2 id="httpæœåŠ¡å™¨">HTTPæœåŠ¡å™¨</h2>

<ul>
  <li>
    <p><code class="highlighter-rouge">request</code>å¯¹è±¡å°è£…äº†HTTPè¯·æ±‚ï¼Œæˆ‘ä»¬è°ƒç”¨<code class="highlighter-rouge">request</code>å¯¹è±¡çš„å±æ€§å’Œæ–¹æ³•å°±å¯ä»¥æ‹¿åˆ°æ‰€æœ‰HTTPè¯·æ±‚çš„ä¿¡æ¯ï¼›</p>
  </li>
  <li>
    <p>response<code class="highlighter-rouge">å¯¹è±¡å°è£…äº†HTTPå“åº”ï¼Œæˆ‘ä»¬æ“ä½œ</code>response`å¯¹è±¡çš„æ–¹æ³•ï¼Œå°±å¯ä»¥æŠŠHTTPå“åº”è¿”å›ç»™æµè§ˆå™¨ã€‚</p>
  </li>
  <li>
    <p>æ¡ˆä¾‹ï¼šåœ¨ç½‘é¡µæ‰“å°ã€€<code class="highlighter-rouge">Hello world!</code>ï¼š</p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>'use strict'
//å¯¼å…¥httpæ¨¡æ¿
var http=require('http');
//åˆ›å»ºhttp server,å¹¶ä¼ å…¥å›è°ƒå‡½æ•°ï¼›
var server=http.createServer(function(request,response){
    //å›è°ƒå‡½æ•°æ¥æ”¶requestå’Œresponseå¯¹è±¡ï¼›
    //è·å¾—ï¼¨ï¼´ï¼´ï¼°è¯·æ±‚çš„ï½ï½…ï½”ï½ˆï½ï½„å’Œï½•ï½’ï½Œ;
    console.log(request.method+":"+request.url);
    //å°†Httpå“åº”200å†™å…¥response,åŒæ—¶è®¾ç½®content-Typeï¼štext/html;
    response.writeHead(200,{'Content-Type':'text/html'});
    //å°†Httpå“åº”çš„HTMLå†…å®¹å†™å…¥åˆ°response;
    response.end('&lt;h1&gt;Hello World!&lt;/h1&gt;')
});
//è®©æœåŠ¡å™¨ç›‘å¬ï¼˜ï¼ï¼˜ï¼ç«¯å£
server.listen(8080);
console.log('Server is running at http://192.168.196.95:8080');
  
//æ§åˆ¶å°æ‰“å°ç»“æœï¼š
Server is running at http://192.168.196.95:8080
GET:/
GET:/favicon.ico
  
ç½‘é¡µè¿è¡Œè¾“å‡ºï¼šHello World!
</code></pre></div>    </div>
  </li>
</ul>

<h2 id="æ–‡ä»¶æœåŠ¡å™¨">æ–‡ä»¶æœåŠ¡å™¨</h2>

<p>ï¼µï¼²ï¼¬è§£æï¼š<code class="highlighter-rouge">parse()</code>å°†ä¸€ä¸ªå­—ç¬¦ä¸²è§£æä¸ºä¸€ä¸ª<code class="highlighter-rouge">Url</code>å¯¹è±¡ï¼š</p>

<p>æ¡ˆä¾‹ï¼š</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>'use strict';
var url = require('url');
console.log(url.parse('http://user:pass@host.com:8080/path/to/file?query=string#hash'));
</code></pre></div></div>

<p>è¿è¡Œç»“æœå¦‚ä¸‹ï¼š</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Url {
  protocol: 'http:',
  slashes: true,
  auth: 'user:pass',
  host: 'host.com:8080',
  port: '8080',
  hostname: 'host.com',
  hash: '#hash',
  search: '?query=string',
  query: 'query=string',
  pathname: '/path/to/file',
  path: '/path/to/file?query=string',
  href: 'http://user:pass@host.com:8080/path/to/file?query=string#hash' }
</code></pre></div></div>

<h3 id="å¤„ç†æœ¬åœ°æ–‡ä»¶ç›®å½•éœ€è¦ä½¿ç”¨nodejsæä¾›çš„pathæ¨¡å—å®ƒå¯ä»¥æ–¹ä¾¿åœ°æ„é€ ç›®å½•">å¤„ç†æœ¬åœ°æ–‡ä»¶ç›®å½•éœ€è¦ä½¿ç”¨Node.jsæä¾›çš„<code class="highlighter-rouge">path</code>æ¨¡å—ï¼Œå®ƒå¯ä»¥æ–¹ä¾¿åœ°æ„é€ ç›®å½•ï¼š</h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>'use strict';
var path = require('path');

// è§£æå½“å‰ç›®å½•:
var workDir = path.resolve('.'); // '/Users/michael'

// ç»„åˆå®Œæ•´çš„æ–‡ä»¶è·¯å¾„:å½“å‰ç›®å½•+'pub'+'index.html':
var filePath = path.join(workDir, 'pub', 'index.html');
// '/Users/michael/pub/index.html'
ä½¿ç”¨pathæ¨¡å—å¯ä»¥æ­£ç¡®å¤„ç†æ“ä½œç³»ç»Ÿç›¸å…³çš„æ–‡ä»¶è·¯å¾„ã€‚åœ¨Windowsç³»ç»Ÿä¸‹ï¼Œè¿”å›çš„è·¯å¾„ç±»ä¼¼äºC:\Users\michael\static\index.htmlï¼Œè¿™æ ·ï¼Œæˆ‘ä»¬å°±ä¸å…³å¿ƒæ€ä¹ˆæ‹¼æ¥è·¯å¾„äº†ã€‚
---------------------------------------------------------------------
æœ€åï¼Œæˆ‘ä»¬å®ç°ä¸€ä¸ªæ–‡ä»¶æœåŠ¡å™¨file_server.jsï¼š
'use strict';
var
    fs = require('fs'),     //è¯»å†™æ–‡ä»¶
    url = require('url'),   
    path = require('path'),  //ç»„åˆæ–‡ä»¶è·¯å¾„
    http = require('http');

// ä»å‘½ä»¤è¡Œå‚æ•°è·å–rootç›®å½•ï¼Œé»˜è®¤æ˜¯å½“å‰ç›®å½•:
var root = path.resolve(process.argv[2] || '.');
console.log('Static root dir: ' + root);

// åˆ›å»ºæœåŠ¡å™¨:
var server = http.createServer(function (request, response) {
    // è·å¾—URLçš„pathï¼Œç±»ä¼¼ '/css/bootstrap.css':
    var pathname = url.parse(request.url).pathname;
    // è·å¾—å¯¹åº”çš„æœ¬åœ°æ–‡ä»¶è·¯å¾„ï¼Œç±»ä¼¼ '/
    srv/www/css/bootstrap.css':
    var filepath = path.join(root, pathname);
    // è·å–æ–‡ä»¶çŠ¶æ€:
    fs.stat(filepath, function (err, stats) {
        if (!err &amp;&amp; stats.isFile()) {
            // æ²¡æœ‰å‡ºé”™å¹¶ä¸”æ–‡ä»¶å­˜åœ¨:
            console.log('200 ' + request.url);
            // å‘é€200å“åº”:
            response.writeHead(200);
            // å°†æ–‡ä»¶æµå¯¼å‘response:
            fs.createReadStream(filepath).pipe(response);
        } else {
            // å‡ºé”™äº†æˆ–è€…æ–‡ä»¶ä¸å­˜åœ¨:
            console.log('404 ' + request.url);
            // å‘é€404å“åº”:
            response.writeHead(404);
            response.end('404 Not Found');
        }
    });
});

server.listen(8080);
console.log('Server is running at http://127.0.0.1:8080/');
</code></pre></div></div>

<p>â€“ã€‹</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>å‘½ä»¤è¡Œè¾“å…¥ï¼š
node file_server.js /path/to/dirï¼ŒæŠŠ/path/to/diræ”¹æˆä½ æœ¬åœ°çš„ä¸€ä¸ªæœ‰æ•ˆçš„ç›®å½•ï¼Œç„¶ååœ¨æµè§ˆå™¨ä¸­è¾“å…¥http://localhost:8080/index.htmlï¼š
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>fs=[object Object]
url=[object Object]
path=[object Object]
http=[object Object]
Static root dir:/home/lixuehe/workspace/NodeJs-
                02/home/lixuehe/workspace/JavaScript-day02/js01-lunbo
Server is running at http://192.168.196.95:8080/
request.url=/lunbo.html
pathname=/lunbo.html
filepath=/home/lixuehe/workspace/NodeJs-            02/home/lixuehe/workspace/JavaScript-day02/js01-lunbo/lunbo.html
</code></pre></div></div>

<h3 id="å¼•ç”¨çŸ¥è¯†">å¼•ç”¨çŸ¥è¯†</h3>

<blockquote>
  <h4 id="pathjoin">path.join</h4>

  <p>path.join() æ–¹æ³•ä½¿ç”¨å¹³å°ç‰¹å®šçš„åˆ†éš”ç¬¦æŠŠå…¨éƒ¨ç»™å®šçš„ path ç‰‡æ®µè¿æ¥åˆ°ä¸€èµ·ï¼Œå¹¶è§„èŒƒåŒ–ç”Ÿæˆçš„è·¯å¾„ã€‚</p>

  <ul>
    <li>â€¦paths stringç±»å‹</li>
  </ul>

  <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>path.join(__dirname, './02art-template.js');
// 'C:\Users\liangliang17\Desktop\Node_study\Node\5.path\02.art-template.js'

path.join('/foo', 'bar', './baz');
// '/foo/bar/baz'

path.join('/foo', 'bar', '/baz', '..');
// '/foo/bar'
</code></pre></div>  </div>

  <h4 id="pathresolve">path.resolve</h4>

  <p>path.resolve() æŠŠä¸€ä¸ªè·¯å¾„æˆ–è·¯å¾„ç‰‡æ®µçš„åºåˆ—è§£æä¸ºä¸€ä¸ªç»å¯¹è·¯å¾„ã€‚</p>

  <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>path.resolve([...paths])
</code></pre></div>  </div>

  <ul>
    <li>â€¦paths stringç±»å‹</li>
  </ul>

  <ol>
    <li>ç»™å®šçš„è·¯å¾„çš„åºåˆ—æ˜¯ â€œä»å³å¾€å·¦â€ è¢«å¤„ç†çš„ï¼Œåé¢æ¯ä¸ª path è¢«ä¾æ¬¡è§£æï¼Œç›´åˆ°æ„é€ å®Œæˆä¸€ä¸ªç»å¯¹è·¯å¾„ã€‚</li>
  </ol>

  <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>path.resolve('foo', '/baz', 'bar');
// 'C:\baz\bar'
</code></pre></div>  </div>

  <ol>
    <li>å¦‚æœå¤„ç†å®Œå…¨éƒ¨ç»™å®šçš„ path ç‰‡æ®µåè¿˜æœªç”Ÿæˆä¸€ä¸ªç»å¯¹è·¯å¾„ï¼Œåˆ™å½“å‰å·¥ä½œç›®å½•ï¼ˆç»å¯¹è·¯å¾„ï¼‰ä¼šè¢«ç”¨ä¸Šã€‚</li>
  </ol>

  <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>path.resolve('bar', 'baz', 'foo');
// 'C:\Users\liangliang17\Desktop\Node_study\Node\5.path\bar\baz\foo'
</code></pre></div>  </div>

  <ol>
    <li>ç”Ÿæˆçš„è·¯å¾„æ˜¯è§„èŒƒåŒ–åçš„ï¼Œä¸”æœ«å°¾çš„æ–œæ ä¼šè¢«åˆ é™¤ï¼Œé™¤éè·¯å¾„è¢«è§£æä¸ºæ ¹ç›®å½•ã€‚</li>
  </ol>

  <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>path.resolve('/foo', 'bar/', 'baz/');
// 'C:\foo\bar\baz' 
// æ³¨æ„ï¼šfooå‰é¢çš„ '/' ä»£è¡¨æ ¹ç›®å½•ï¼Œå³'C:'; å¹¶ä¸”bazæœ«å°¾çš„æ–œçº¿ä¼šåˆ é™¤

path.resolve('/');
// 'C:\' å¦‚æœè·¯å¾„ä¸ºæ ¹è·¯å¾„ï¼Œæœ«å°¾çš„æ–œçº¿ä¸ä¼šåˆ é™¤
</code></pre></div>  </div>

  <ol>
    <li>é•¿åº¦ä¸ºé›¶çš„pathç‰‡æ®µä¼šè¢«å¿½ç•¥</li>
  </ol>

  <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>path.resolve('foo', '/baz', '', 'bar');
// 'C:\baz\bar'
</code></pre></div>  </div>

  <ol>
    <li>å¦‚æœæ²¡æœ‰ä¼ å…¥pathç‰‡æ®µï¼Œåˆ™resolveä¼šè¿”å›å½“å‰å·¥ä½œç›®å½•çš„ç»å¯¹è·¯å¾„</li>
  </ol>

  <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>path.resolve();
// 'C:\Users\liangliang17\Desktop\Node_study\Node\5.path'
</code></pre></div>  </div>
</blockquote>

<h4 id="crypto">crypto</h4>

<p>ç›®çš„ï¼šæä¾›é€šç”¨çš„åŠ å¯†å’Œå“ˆå¸Œç®—æ³•ï¼›</p>

<h3 id="md5å’Œsha1">MD5å’ŒSHA1</h3>

<p>MD5æ˜¯ä¸€ç§å¸¸ç”¨çš„å“ˆå¸Œç®—æ³•ï¼Œç”¨äºç»™ä»»æ„æ•°æ®ä¸€ä¸ªâ€œç­¾åâ€ã€‚è¿™ä¸ªç­¾åé€šå¸¸ç”¨ä¸€ä¸ªåå…­è¿›åˆ¶çš„å­—ç¬¦ä¸²è¡¨ç¤ºï¼š</p>
:ET